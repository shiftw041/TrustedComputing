**考试微助教需要用电脑，用手机不方便而且会出现问题。**
 
**不要使用粘贴！！不要使用粘贴！！不要使用粘贴！！**
即使能成功粘贴到输入框，这部分输入也会被屏蔽，会造成考试交白卷的尴尬情况！！

课本[可信计算技术原理与应用 (sciencereading.cn)](https://book.sciencereading.cn/shop/book/Booksimple/show.do?id=BD5FF2F75D8C6452EB1AA529CBAE80C74000)
下载pdf:根目录有下载好的老版，或者参考[how to download pdf](https://shiftw041.github.io/site/posts/HowToDownloadScienceReadingBook/)
试题参考网址：
https://blog.csdn.net/weixin_33829657/article/details/86356577#:~:text=%E4%B8%8D%E5%8F%AF%E8%BF%81%E7%A7%BB%E5%AF%86%E9%92%A5%E6%9C%AC%E8%BA%AB,%E4%B8%8D%E5%8F%AF%E8%BF%81%E7%A7%BB%E5%AF%86%E9%92%A5%EF%BC%89%E3%80%82
https://blog.csdn.net/kaarwen/article/details/124807889
https://blog.csdn.net/qq_40487134/article/details/112440497
https://blog.csdn.net/Trieyes_of_feng/article/details/125324920


# 汇总：
## TPM概念
1. Storage Keys：存储密钥，用来加密数据和其它密钥的通用非对称密钥，这里的其它密钥可以是另外一个存储密钥，也可以是绑定密钥或签名密钥。它本身是长度2048bit的RSA私钥；它既可以是可迁移密钥，也可以是不可迁移密钥。


2. SRK：storage Root Key，存储根密钥，是存储密钥的一个特例。整个系统拥有一个最高权限的存储密钥，这个最高级密钥也就是存储根密钥。它很特殊，在每个用户创建的时候生成，管理这个用户的所有数据，也就是存储可信根（Root of Trust for Storage, RTS）.和签署密钥（Endorsement Key，EK）一样，一个TPM仅存在唯一一个。所有其它的密钥都在存储根密钥的保护之下。


3. 签名密钥（Signing Key）：是非对称密钥，用于对应用数据和信息签名。签名密钥可以是可迁移或不可迁移的。可迁移密钥能够在TPM之间传递，通过迁移密钥传递保密数据。TPM中的签名密钥都遵循RSA签名密钥的标准，它们有若干种不同长度。TPM能够正确地进行处理的最大密钥长度是2048bit。


4. 签署密钥，或背书密钥（Endorsement Key，EK）是一个TPM平台的不可迁移的解密密钥，它是一个2048bit的RSA密钥对。它生成于平台的生产过程中，代表着每个平台的真实身份，每个平台都拥有唯一的一个。在确定平台所有者时，用于解密所有者的授权数据，还有解密与生成AIK相关的数据。签署密钥从不用作数据加密和签名。签署密钥的主要功能是生成身份证明密钥（AIK）和建立TPM平台的所有者，由TPM的所有者来生成存储根密钥SRK，使用SRK来加密、存储其他的密钥。
EK可以通过密钥生成服务器，采用两种方法来产生：一种使用TPM命令，TCG规范定义了一组背书密钥操作命令，其中创建背书密钥对的命令为TPM_CreateEndorsementKeyPair，产生密钥长度要求至少2048位。另外一种方法是密钥注入技术，在信任制造商的前提下，由TPM制造商产生背书密钥对，然后采用人工方式注入，注入方法有：键盘输入、软盘输入、专用密钥抢输入等。
对比这两种方法，前者必须依赖硬件中提供受保护的功能和被隔离的位置，从而保证在设备内部产生密钥对，而且密钥对是在篡改保护的环境下产生，能够很好地减少密钥对泄露的风险。


5. AIK：认证身份密钥，或平台身份认证密钥（Attestation Identity Key）是不可迁移密钥。专用于对TPM产生的数据（如TPM功能、PCR寄存器的值等）进行签名，用来证明平台的身份和平台的环境配置，凡是经过AIK签名的实体，都表明已经经过TPM的处理。每个用户可以拥有多个AIK，每个AIK的生成都需要可信第三方的支持。


6. 绑定密钥（Binding Keys）:用于在一个平台中加密小规模数据（如对称密钥），然后在另一个TPM平台上进行解密。由于使用平台所特有的密钥加密，所以与该平台绑定。这个密钥的用法同传统非对称密钥加密相同。


7. 密封密钥（Sealing Keys）：内置TPM的计算机可以创建一个密钥，该密钥不仅被绑定，而且还被连接到特定硬件或软件条件，这就是密封密钥。首次创建密封密钥时TPM将记录配置值和文件哈希的快照。仅在这些当前系统值与快照中的值想匹配时才能解封或释放密封密钥。


8. 遗留密钥（legacy Keys）：在TPM之外生成，它们被定义为可迁移的，在被用来签名或加密之后才能载入TPM。这些密钥用在一些需要在平台之间传递数据的场合。


9. 鉴别密钥（Authentication Keys）：用来保护涉及TPM传输会话的对称密钥。


10. Key Management：为了更有效地管理存储在TPM外边的密钥，引进一种密钥缓冲管理机制（Key Cache Manager），它主要管理TPM中受限制的资源，并且对应用程序调用隐藏这些限制。应用程序可以通过利用KCM来载入密钥到TPM中，并假定此密钥可以进一步利用。KCM负责保证当应用程序某个命令需要密钥时，这个已经被应用程序载入的密钥存在于TPM中。如果所有TPM资源被占用，KCM需要释放资源将不经常使用的密钥从TPM取出来，以便为那些经常进出TPM的密钥腾出空间，将需要的密钥放入TPM。应用程序需要利用KCM来将密钥载入TPM中。


11. 可迁移密钥和不可迁移密钥：在整个TPM/TCM的密钥体系中，每个密钥在开始创建的时候都需要指定密钥属性。密钥按照属性不同分为：可迁移密钥（Migratable Key）和不可迁移密钥（Non-Migratable Key）。可迁移密钥并不局限于某个特定平台，可以由平台用户的控制在平台之间迁移。不可迁移密钥则永久地与某个指定平台关联。不可迁移密钥能够用来加密保护可迁移密钥，反之则不可。
不可迁移密钥由TPM内部产生，在TPM产生之后就被打上了TPM的标记。不可迁移密钥本身的安全性要比可迁移密钥高，因为不可迁移密钥全部由TPM内部产生并且从产生到销毁整个周期私钥部分都不会离开TPM（除非不可迁移密钥转化为可迁移密钥，这个时候安全级别降低，注意的是由于可迁移密钥安全级别低所以无法转化为不可迁移密钥）。同时不可迁移密钥可以被TPM签名，从而可以向挑战者或者用户证明其不可迁移的属性，从而证明其安全性。
## 密码学及PKI简述
1.为什么TCG组织认为TPM没有必要支持对称加密算法？
> 必不必要：对称加密算法用于加密数据。机器是在安全环境下，TPM效率比较低，首选使用软件来进行对称加密算法（用CPU）；机器在不安全的情况下，用TPM来做对称加密和用软件来做对于黑客来说，是没有意义的。黑客只在意于明文，机器不安全的时候，黑客是知道明文的。
> 值不值得：对称加密加密的数据比较大，对于OI的成本高。
> 注：TCM支持对称加密算法

2）为什么要支持非对称
> 在对称加密中密钥不重要，但在非对称加密的私钥很重要。私钥对于TPM来说保护尤为重要。
> 非对称加密的数据量比较小，可以使用TPM进行加密。

3）可信平台芯片TPM与CPU的连接方式？
> 可信LPC总线

4）常见的hash算法有哪些（国内、国外），hash算法的性质和特点？
> 国外：MD4、MD5、SHA-1、SHA-224、SHA-256、SHA-384、SHA-512
> 国密：SM3，SMx（x为数字）
> hash算法的性质：将大范围映射到一个小范围
> 特点：不可逆（单向）、输出数据长度固定、输入敏感（原始输入信息修改一点，得到哈希值大不相同）、无碰撞（碰撞概率非常小）

5）常见的对称加密算法和非对称加密算法有哪些（国内、国外），特色和应用场景？
> 国外：
>   对称加密算法：DES、Triple-DES、AES
>   非对称加密算法：RSA、ECC
> 国密：
>   对称加密算法：SMS4
>   非对称加密算法：SM2
> 特色:
> 对称密钥:使用相同的密钥对消息进行加密和解密；显著缺点是安全地使用它们所需的密钥管理
> 非对称密钥:使用不同的密钥进行加密和解密；速度比较慢；密文长度大于明文长度。

6）为什么需要PKI，证书和公私密钥对的关系
> 公钥是随机生成的，公钥和用户之前缺少天然的绑定关系。
> 证书：第三方CA对公钥进行公证，公证之后的公钥就是证书。
> 引入证书：将公钥和用户身份关联起来。

## TPM核心功能
1）TPM的1.0版本和1.2版本分别有多少个PCRs？
> TPM1.0版本16个，1.2版本有24个。（喵酱也不确定）
> 
2）TPM是如何报告平台状态的？
> 两种报告方式：远程报告和本地报告。
> 远程报告：被证明平台将TPM中完整度量值报告给远程挑战者。远程挑战者获取到可信平台用自身AIK密钥签名的PCR值，可信平台除了发送已签名的PCR外，还包括有度量日志和AIK证书，通过验证AIK证书、AIK签名和nonce的合法性证实平台的身份。挑战者将PCR值与期望值比较可以验证被证明平台的可信性。

> 本地报告：当挑战者要判断本地机器是否被攻陷，意味着本机有可能是不可信的。如果本机已经被攻击者控制，那么可信判断所得到的结果就会被攻击者篡改，挑战者就会受到欺骗。
> ①可以将一个机密信息绑定到PCR值来标志一个可信的启动过程。
> ②当要判断及其的启动过程是否可信，用户可以要求TPM对这条秘密信息执行Unseal操作。如果这条Seal的机密信息能够被释放，那么就表示相应的PCR值都符合期望值，进而说明启动过程是安全的。
> ③删除口令，破坏PCR的值。

3）描述TPM可迁移密钥和不可签名密钥的定义，哪种密钥更安全，为什么？能否相互转换？
> 可迁移密钥 并不局限某个特定平台，可以由平台用户的控制下在平台之间迁移。不可迁移密钥永久地与某个指定平台关联，不可迁移密钥不会以明文形式离开TPM，不可迁移密钥对TPM中产生的数据进行签名。
> 不可迁移密钥更安全。因为不可迁移密钥全部由TPM内部产生并且从产生到销毁整个周期私钥部分都不会离开TPM。不可迁移密钥能够用来加密保护可迁移密钥，反之不行。
> 不可迁移密钥可以转换为可迁移密钥，但不可逆。

4）描述TPM什么时候谁可以执行PCR Reset操作和PCR Extend操作？
Reset操作：发生在机器断电或者重新启动之后，PCR的值自动重新清零。

Extend操作：在系统运行过程中，只能通过扩展操作来改变PCR的内容。
![alt text](image.png)

5）为什么PCR Extend操作可以抵御攻击？
1、扩展操作不可逆，先扩展度量值A再扩展度量值B得到的PCR的值跟先扩展B再扩展A的结果不同。
2、通过扩展，PCR能够记录一个无限长的度量值序列，这一系列度量值组成的序列反应了系统状态的变迁。
3、扩展序列中的某一个度量值被改变，之后的度量序列都会收到影响。

6）CRTM是什么？为什么是不可修改的？假如修改会产生何种攻击？
CRTM是Core root of trust for measurement，即核心可信度量根。

对所有度量的信任都基于CRTM的完整性

核心可信度量根如果遭受篡改，则整个平台的安全性就丧失了，攻击者可以构造自己的信任链，可以往PCR中写入任意值，可以轻易做到远程证明等操作。

7）为什么TPM支持多个AIK？
隐私保护，为了尽量减少隐私泄露，TCG规定不能使用EK来做身份认证，而使用AIK，TPM使用EK生成AIK，然后通过PCA签发AIK证书完成身份认证。

平台支持多用户，每个用户都需要一个AIK来证明自己的身份。

8）PCR是什么
平台状态寄存器PCR是用来记录系统运行状态的寄存器

9）如何进行可信的本地报告
①可以将一个机密信息绑定到PCR值来标志一个可信的启动过程。
②当要判断及其的启动过程是否可信，用户可以要求TPM对这条秘密信息执行Unseal操作。如果这条Seal的机密信息能够被释放，那么就表示相应的PCR值都符合期望值，进而说明启动过程是安全的。
③删除口令，破坏PCR的值。

10）描述一下信任链的产生过程？日志的作用，以及为什么日志不需要防篡改？
信任产生过程：在信任当前某一环节的前提下，由该环节去评估下一个环节的安全性，确定下一环节可信之后再将控制权转交给下一环节，然后依次向后推进。整个启动序列中都遵循“先度量，再执行”的原则，当前阶段的代码负责度量下一阶段即将要执行的代码，然后再将度量值扩展到PCR寄存器中，这样循环往复，这就构成了信任链。

各阶段代码的详细配置信息和对PCR值扩展的操作的历史记录是保存在度量日志中的，度量日志存储在磁盘上，而磁盘属于不可信的外存，因此度量日志是可能被攻击者篡改的。对保存在磁盘上的度量日志并不需要进行额外的保护，攻击者即使篡改了度量日志，但由于PCR中记录的度量值是不可伪造的，用户对度量日志进行摘要就会发现与度量值不匹配。

11）EK是什么？主要用途是什么？可迁移密钥还是不可迁移密钥？
背书密钥

主要用途：代表每个平台的真实身份，生成身份证明密钥AIK和建立TPM平台的所有者，由TPM的所有者来生成SRK

不可迁移密钥

12）AIK是什么？主要用途是什么？可迁移密钥还是不可迁移密钥？
平台身份认证密钥

主要用途：用于对TPM产生数据进行签名，用来证明平台的身份和平台的环境配置。

不可迁移密钥

13）SRK是什么？主要用途是什么？可迁移密钥还是不可迁移密钥？
存储根密钥

主要用途：在用户创建时生成，管理用户的所有数据。

不可迁移密钥，一个TPM仅存在唯一一个。

14）Sealing Key是什么？主要用途是什么？可迁移密钥还是不可迁移密钥？
密封密钥：内置了TPM的计算机可以创建一个密钥，该密钥不仅被绑定，而且还被连接到特定硬件或软件条件。首次创建密封密钥时，TPM将记录配置值和文件哈希的快照，仅在这些当前系统值与快照中的值相匹配时才解封或释放密封密钥。

主要用途：将秘密数据密封到平台。

不可迁移？

15）如何借助Seal功能保护数据安全？
![alt text](image-1.png)
在密封中，把信息M与TPM的一个状态关联起来，只有当TPM的状态与密封时的状态相同时，才有可能把密封过的信息恢复到原来的信息。换言之，当且仅当密封时的TPM状态与解密封时的TPM状态相同时，解密封操作才能成功。

16）什么是Binding Keys？主要用途是什么？
绑定密钥用于在一个平台中加密小规模数据，然后再另一个TPM平台上进行解密。由于使用平台所特有的密钥加密，所以与该平台绑定。

这个密钥的用法同传统非对称密钥加密相同。

不可迁移密钥

17）描述一下远程证明的过程？
![alt text](image-2.png)

1. 远程挑战者请求一次摘要，对可信平台客户端发起挑战请求，指定PCR寄存器编号并发送随机数nonce（以防止重放攻击）
2. 配置TPM的客户端与TSS交互，载入AIK，调用Tspi_TPM_Quote接口对指定的PCR签名
   1. 首先，将PCR寄存器值和nonce串联并用SHA1算法求出度量值，然后使用



